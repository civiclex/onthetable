<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Choropleth Template</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
// load the custom css
    <link rel="stylesheet" href="css/basic.css"/>

// load the javascript libraries specifically Leaflet
   
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>
    
// load the Leaflet CSS stylesheet

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin=""/>
    
    <style>
        
    </style>
</head>

<body>
    <header>

        <h1>On The Table 2020 Registrations</h1>
        
    </header>

    <div id='map'></div>
    
     <!-- Load JQuery -->  
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    
    
    <script>
    //create the empty layers
        var focustracts = L.layerGroup(),
        zipcodes = L.layerGroup(); 
        
    //Initialize the leaflet map
        var map = L.map('map', {
            center: [38.0147,-84.483],
            zoom: 11,
            //minZoom: 10,
            //maxZoom: 26,
            zoomControl: true,
            dragging: true,
        });
               
    //Create the baselayer and add it to the map
        var baselayer = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}', {
	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	subdomains: 'abcd',
	minZoom: 0,
	maxZoom: 20,
	ext: 'png'
});
        map.addLayer(baselayer);     
        
    //Create the census tract layer from the geojson
    //Need to add an on mouse over that makes the name appear
       $.getJSON("data/focustracts.geojson", function(data) {
            focustractsLayer = L.geoJson(data, {
            onEachFeature: function ( feature, layer ){
            focustracts.addLayer(layer)},
            weight: 1,
            opacity: 1,
            color: '#264653',
            dashArray: '3',
            //fillColor: '#264653',
            //fillOpacity: 1
        }).addTo(map);
    });
        
/*    //Create the zipcode layer from the geojson
         $.getJSON("data/zipcode_tally.geojson", function(data) {
            zipcodesLayer = L.geoJson(data, {
            onEachFeature: function ( feature, layer ){
            zipcodes.addLayer(layer)},
            weight: 1,
            opacity: 1,
            color: '#264653',
            dashArray: '3',
            //fillColor: '#264653',
            //fillOpacity: 1
        }).addTo(map);
    });*/
        
            //Create the zipcode layer from the geojson
         $.getJSON("data/zipcode_tally.geojson", function(data) {
            zipcodesLayer = L.geoJson(data, {
                style: style,
                onEachFeature: onEachFeature 
        }).addTo(map);
    });
        
        /*var geojson = L.geoJson(tracts, {
        		style: style,
        		onEachFeature: onEachFeature
        }).addTo(map);*/
        
    // Add layers to map so they are automatically selected in the layer control
        map.addLayer(focustracts)
        map.addLayer(zipcodes)
    
    // Create groupings for layer controller
        var userLayers = {
            "Focus Tracts": focustracts,
            //"Zipcodes": zipcodes
        };

    // Add layer controller to Map
        L.control.layers(null, userLayers).addTo(map); // the first item is always a radio button

        		
    //Create a leaflet control for the legend
    //Give the legend an onAdd handler
    //Add the legend to the map
        var legend = L.control({position: 'bottomright'});
        
        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend'),
                grades = [5, 10, 25, 50],
                labels = [];
            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length; i++) {
                console.log("legend for "+ grades[i] + " to "+grades[i+1]+" = " +getColor(grades[i] + 1));
                div.innerHTML +=
                    '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
                    grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
            }  
            return div;
        };
        legend.addTo(map);
        
        
    //STYLE CREATION    
    //Given a value for the property Count, return a specific color
    //This should be written to autogenerate quantiles
    function getColor(Count) {
        return Count >= 50 ? '#80D44E' :
           Count >= 25 ? '#9AEE68' :
           Count >= 10 ? '#B3FF81' :
           Count >= 5 ? '#E6FFB4' :
                      '#FFFFCD';
    } 
        
    //Given a feature, return an object with style properties that leaflet unsderstands   
    function style(feature) {
        return {
            fillColor: getColor(feature.properties.Count),
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
        }
    }    
 
    //**
    //DOM EVENTS (Interactive stuff)
    //Change a layer's style when passed a DOM event (e)
    function highlightFeature(e) {
    	var layer = e.target;
    	layer.setStyle({
    		weight: 5,
    		color: '#666',
    		dashArray: '',
    		fillOpacity: 0.7
        });

    	if (!L.Browser.ie && !L.Browser.opera) {
    		layer.bringToFront();
    	}

        //FIXME: Info hasn't been defined
	    info.update(layer.feature.properties);
    }
    
    //Reset a layer's style when passed a DOM event 
    //(I guess leaflet keeps track of past layer styles?)    
    function resetHighlight(e) {
        geojson.resetStyle(e.target);
        //FIXME: Info hasn't been defined
    	info.update();
    }
    
    //Zoom to a feature when passed a DOM event
    function zoomToFeature(e) {
    	map.fitBounds(e.target.getBounds());
    }
    
    //Now that the event handlers are written, assign them to
    //specific DOM events that could happen to the layer
    function onEachFeature(feature, layer) {
    	/*layer.on({
    		mouseover: highlightFeature,
    		mouseout: resetHighlight,
    		click: zoomToFeature
    	});*/
    }
            
    </script>
    
</body>

</html>
